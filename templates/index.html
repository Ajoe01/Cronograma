<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cronograma UTB - Sistema Completo</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<!-- ========== LOGIN / REGISTRO ========== -->
<div id="loginScreen">
  <div class="auth-box">
    <div class="auth-logo">
      <span class="esc">ğŸ“</span>
      <h1>Universidad TecnolÃ³gica de BolÃ­var</h1>
      <p>Cronograma de Actividades</p>
    </div>

    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Iniciar SesiÃ³n</button>
      <button class="auth-tab" onclick="switchTab('reg')">Registrarse</button>
    </div>

    <!-- LOGIN -->
    <div id="tabLogin">
      <div class="fg">
        <label>ğŸ‘¤ Usuario</label>
        <input type="text" id="liUser" placeholder="Tu usuario" onkeydown="if(event.key==='Enter')login()">
      </div>
      <div class="fg">
        <label>ğŸ”’ ContraseÃ±a</label>
        <input type="password" id="liPass" placeholder="Tu contraseÃ±a" onkeydown="if(event.key==='Enter')login()">
      </div>
      <button class="btn-auth" onclick="login()">ğŸ” Ingresar</button>
      <div class="auth-msg" id="liMsg"></div>
    </div>

    <!-- REGISTRO -->
    <div id="tabReg" style="display:none">
      <div class="usuarios-info">
        MÃ¡ximo <strong>5 usuarios</strong> Â· Registrados: <strong id="cntUsers">0</strong> / 5
      </div>
      <div class="form-row">
        <div class="fg">
          <label>ğŸ‘¤ Nombre completo</label>
          <input type="text" id="rNombre" placeholder="Ej: Juan PÃ©rez">
        </div>
        <div class="fg">
          <label>ğŸ·ï¸ Usuario</label>
          <input type="text" id="rUser" placeholder="Sin espacios (ej: jperez)">
        </div>
      </div>
      <div class="fg">
        <label>ğŸ’¼ Cargo / Rol</label>
        <select id="rCargo">
          <option value="">-- Selecciona tu cargo --</option>
          <option value="Director de Proyecto">Director de Proyecto</option>
          <option value="Director de Procesos Mecanicos">Director de Procesos MecÃ¡nicos</option>
          <option value="Director de Procesos Electronicos">Director de Procesos ElectrÃ³nicos</option>
          <option value="DiseÃ±ador de Sistemas de Control">DiseÃ±ador de Sistemas de Control</option>
          <option value="Director Financiero">Director Financiero</option>
        </select>
      </div>
      <div class="form-row">
        <div class="fg">
          <label>ğŸ”’ ContraseÃ±a</label>
          <input type="password" id="rPass" placeholder="MÃ­nimo 4 caracteres">
        </div>
        <div class="fg">
          <label>ğŸ”‘ Confirmar</label>
          <input type="password" id="rPass2" placeholder="Repite la contraseÃ±a">
        </div>
      </div>
      <button class="btn-auth verde" onclick="registrar()">âœ… Crear Cuenta</button>
      <div class="auth-msg" id="rMsg"></div>
    </div>
  </div>
</div>

<!-- ========== APP ========== -->
<div id="appScreen" style="display:none">
  
  <div class="app-header">
    <div class="h-left">
      <div class="h-logo">ğŸ“</div>
      <div class="h-title">
        <h1>Cronograma UTB</h1>
        <p>UNIVERSIDAD TECNOLÃ“GICA DE BOLÃVAR</p>
      </div>
    </div>
    <div class="h-right">
      <div class="u-chip">
        ğŸ‘¤ <span id="curUser">-</span> Â· 
        <span id="curCargo" style="opacity:.8;font-size:.78rem;"></span>
      </div>
      <button class="btn-out" onclick="logout()">Salir</button>
    </div>
  </div>

  <div class="accent-bar"></div>

  <!-- NavegaciÃ³n de pestaÃ±as -->
  <div class="tabs-nav">
    <button class="tab-btn active" onclick="cambiarTab('actividades')">
      ğŸ“‹ Actividades
    </button>
    <button class="tab-btn" onclick="cambiarTab('finanzas')">
      ğŸ’° Finanzas
    </button>
    <button class="btn-export" onclick="exportarExcel()">
      ğŸ“Š Exportar Excel
    </button>
  </div>

  <!-- ========== TAB: ACTIVIDADES ========== -->
  <div id="tabActividades" class="tab-content">
    
    <!-- Leyenda -->
    <div class="leyenda">
      <div class="li"><div class="ld am"></div>ğŸŸ¡ En ejecuciÃ³n</div>
      <div class="li"><div class="ld az"></div>ğŸ”µ Completado prematuro</div>
      <div class="li"><div class="ld vd"></div>ğŸŸ¢ Completado a tiempo</div>
      <div class="li"><div class="ld na"></div>ğŸŸ  Retraso leve</div>
      <div class="li"><div class="ld ro"></div>ğŸ”´ Retraso grave</div>
    </div>

    <div class="app-body">
      <div class="stats" id="statsGrid"></div>

      <div class="act-bar">
        <h2>ğŸ“‹ Actividades del Proyecto</h2>
        <button class="btn-nueva" onclick="abrirModalActividad()">ï¼‹ Nueva Actividad</button>
      </div>

      <div class="filtros">
        <button class="fb active" onclick="filtrar('todas',this)">Todas</button>
        <button class="fb" onclick="filtrar('default',this)">ğŸŸ¡ En ejecuciÃ³n</button>
        <button class="fb" onclick="filtrar('prematuro',this)">ğŸ”µ Prematuras</button>
        <button class="fb" onclick="filtrar('tiempo',this)">ğŸŸ¢ A tiempo</button>
        <button class="fb" onclick="filtrar('leve',this)">ğŸŸ  Retraso leve</button>
        <button class="fb" onclick="filtrar('tarde',this)">ğŸ”´ Retraso grave</button>
      </div>

      <div class="tabla-wrap">
        <div class="t-head">
          <span>Actividad</span>
          <span>Responsable</span>
          <span>Inicio</span>
          <span>Fecha lÃ­mite</span>
          <span>Estado</span>
          <span>Acciones</span>
        </div>
        <div id="actList"></div>
      </div>
    </div>
  </div>

  <!-- ========== TAB: FINANZAS ========== -->
  <div id="tabFinanzas" class="tab-content" style="display:none">
    <div class="app-body">
      
      <div class="fin-header">
        <div>
          <h2>ğŸ’° Control Financiero</h2>
          <p class="fin-subtitle">Registro de compras y gastos del proyecto</p>
        </div>
        <div class="fin-total-box">
          <span class="fin-total-label">Total invertido:</span>
          <span class="fin-total-value" id="finTotal">$0</span>
        </div>
      </div>

      <button class="btn-nueva" onclick="abrirModalFinanza()" id="btnNuevaFinanza">
        ï¼‹ Nuevo Gasto
      </button>

      <div class="tabla-wrap" style="margin-top:2rem">
        <div class="t-head-fin">
          <span>Fecha</span>
          <span>Concepto</span>
          <span>CategorÃ­a</span>
          <span>Proveedor</span>
          <span>Cant.</span>
          <span>V. Unit.</span>
          <span>V. Total</span>
          <span>Acciones</span>
        </div>
        <div id="finList"></div>
      </div>
    </div>
  </div>

</div>

<!-- ========== MODAL ACTIVIDAD ========== -->
<div class="ov" id="modalAct">
  <div class="mbox">
    <button class="mcls" onclick="cerrarModal('modalAct')">âœ•</button>
    <h3 id="mActTitle">Nueva Actividad</h3>
    <div class="fg">
      <label>ğŸ“Œ Nombre de la actividad *</label>
      <input type="text" id="aNom" placeholder="Ej: DiseÃ±o de interfaz">
    </div>
    <div class="fg">
      <label>ğŸ“ DescripciÃ³n breve</label>
      <textarea id="aDesc" rows="2" placeholder="Resumen de la actividad..."></textarea>
    </div>
    <div class="fg">
      <label>ğŸ“„ Detalles adicionales</label>
      <textarea id="aDet" rows="3" placeholder="InformaciÃ³n detallada, objetivos, recursos necesarios..."></textarea>
    </div>
    <div class="fg">
      <label>ğŸ‘¤ Responsable *</label>
      <select id="aResp">
        <option value="">-- Selecciona el responsable --</option>
      </select>
    </div>
    <div class="form-row">
      <div class="fg">
        <label>ğŸ“… Fecha de Inicio *</label>
        <input type="date" id="aIni">
      </div>
      <div class="fg">
        <label>â° Fecha LÃ­mite *</label>
        <input type="date" id="aLim">
      </div>
    </div>
    <div class="fg">
      <label>ğŸ·ï¸ Prioridad</label>
      <select id="aPrio">
        <option value="alta">ğŸ”´ Alta</option>
        <option value="media" selected>ğŸŸ¡ Media</option>
        <option value="baja">ğŸŸ¢ Baja</option>
      </select>
    </div>
    <button class="btn-save" onclick="guardarActividad()">ğŸ’¾ Guardar Actividad</button>
  </div>
</div>

<!-- ========== MODAL DETALLES ACTIVIDAD ========== -->
<div class="ov" id="modalDetalle">
  <div class="mbox mbox-large">
    <button class="mcls" onclick="cerrarModal('modalDetalle')">âœ•</button>
    <h3>ğŸ“‹ Detalles de la Actividad</h3>
    <div id="detalleContent"></div>
  </div>
</div>

<!-- ========== MODAL COMPLETAR ========== -->
<div class="cov" id="confirmOv">
  <div class="cbox">
    <div class="ci">âœ…</div>
    <h3>Â¿Marcar como completada?</h3>
    <p id="confirmTxt">Una vez confirmada no podrÃ¡ editarse.</p>
    <div class="fecha-comp-wrap">
      <label>ğŸ“… Fecha de completado</label>
      <div id="fechaCompletadoDisplay" style="padding:.6rem 1rem;background:#f0f0f0;border-radius:8px;font-weight:700;color:#003B71;font-size:.95rem;border:1px solid #ddd;"></div>
      <input type="hidden" id="fechaCompletado">
    </div>
    <div class="fecha-comp-wrap">
      <label>ğŸ“ Observaciones de cierre</label>
      <textarea id="observaciones" rows="4" placeholder="Describe cÃ³mo se completÃ³ la actividad, resultados obtenidos, dificultades encontradas..."></textarea>
    </div>
    <div class="cbtns">
      <button class="btn-cy" onclick="confirmarCompletar()">SÃ­, confirmar</button>
      <button class="btn-cn" onclick="cerrarConfirm()">Cancelar</button>
    </div>
  </div>
</div>

<!-- ========== MODAL FINANZA ========== -->
<div class="ov" id="modalFin">
  <div class="mbox">
    <button class="mcls" onclick="cerrarModal('modalFin')">âœ•</button>
    <h3 id="mFinTitle">Nuevo Gasto</h3>
    
    <div class="form-row">
      <div class="fg">
        <label>ğŸ“… Fecha de compra *</label>
        <input type="date" id="fFecha">
      </div>
      <div class="fg">
        <label>ğŸ·ï¸ CategorÃ­a</label>
        <select id="fCategoria">
          <option value="">-- Seleccionar --</option>
          <option>Materiales</option>
          <option>Componentes electrÃ³nicos</option>
          <option>Herramientas</option>
          <option>Software</option>
          <option>Servicios</option>
          <option>Transporte</option>
          <option>Otros</option>
        </select>
      </div>
    </div>

    <div class="fg">
      <label>ğŸ“Œ Concepto *</label>
      <input type="text" id="fConcepto" placeholder="DescripciÃ³n de la compra">
    </div>

    <div class="fg">
      <label>ğŸ¢ Proveedor</label>
      <input type="text" id="fProveedor" placeholder="Nombre del proveedor">
    </div>

    <div class="form-row">
      <div class="fg">
        <label>ğŸ”¢ Cantidad *</label>
        <input type="number" id="fCantidad" value="1" min="1" oninput="calcularTotalFin()">
      </div>
      <div class="fg">
        <label>ğŸ’µ Valor Unitario *</label>
        <input type="number" id="fValorUnit" placeholder="0" step="0.01" oninput="calcularTotalFin()">
      </div>
      <div class="fg">
        <label>ğŸ’° Valor Total</label>
        <input type="text" id="fValorTotal" readonly style="background:#f0f0f0;font-weight:700;color:#00843D">
      </div>
    </div>

    <div class="form-row">
      <div class="fg">
        <label>ğŸ’³ MÃ©todo de Pago</label>
        <select id="fMetodo">
          <option value="">-- Seleccionar --</option>
          <option>Efectivo</option>
          <option>Transferencia</option>
          <option>Tarjeta</option>
          <option>Cheque</option>
          <option>Otro</option>
        </select>
      </div>
      <div class="fg">
        <label>ğŸ“„ No. Factura</label>
        <input type="text" id="fFactura" placeholder="Opcional">
      </div>
    </div>

    <div class="fg">
      <label>ğŸ‘¤ Responsable de la compra</label>
      <select id="fResponsable">
        <option value="">-- Selecciona el responsable --</option>
      </select>
    </div>

    <div class="fg">
      <label>ğŸ“ Observaciones</label>
      <textarea id="fObs" rows="2" placeholder="Notas adicionales..."></textarea>
    </div>

    <button class="btn-save" onclick="guardarFinanza()">ğŸ’¾ Guardar Gasto</button>
  </div>
</div>

<script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
