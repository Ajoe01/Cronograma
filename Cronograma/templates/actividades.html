<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cronograma - UTB</title>
<style>
:root {
  --utb-azul:     #003B71;
  --utb-azul2:    #005EB8;
  --utb-verde:    #00843D;
  --utb-verde2:   #00A94F;
  --utb-blanco:   #FFFFFF;
  --utb-gris:     #F4F6F9;
  --utb-gris2:    #E8EDF3;
  --utb-texto:    #1A2B3C;

  --c-amarillo:   #FFF9C4;
  --b-amarillo:   #F9A825;
  --c-azul:       #E3F2FD;
  --b-azul:       #1565C0;
  --c-verde:      #E8F5E9;
  --b-verde:      #2E7D32;
  --c-naranja:    #FFF3E0;
  --b-naranja:    #E65100;
  --c-rojo:       #FFEBEE;
  --b-rojo:       #B71C1C;
}

*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',sans-serif;background:var(--utb-gris);color:var(--utb-texto);min-height:100vh;}

/* ====== LOGIN / REGISTRO ====== */
#loginScreen{
  display:flex;align-items:center;justify-content:center;min-height:100vh;
  background:linear-gradient(135deg,var(--utb-azul) 0%,var(--utb-azul2) 50%,var(--utb-verde) 100%);
}

.auth-box{
  background:white;padding:2.5rem 2.5rem;border-radius:20px;
  box-shadow:0 25px 60px rgba(0,0,0,0.35);width:100%;max-width:440px;
}

.auth-logo{text-align:center;margin-bottom:1.5rem;}
.auth-logo .escudo{font-size:3rem;display:block;margin-bottom:0.5rem;}
.auth-logo h1{color:var(--utb-azul);font-size:1.5rem;font-weight:800;line-height:1.2;}
.auth-logo p{color:var(--utb-verde);font-size:0.85rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;}

.auth-tabs{display:flex;margin-bottom:2rem;border-radius:12px;overflow:hidden;border:2px solid var(--utb-gris2);}
.auth-tab{flex:1;padding:0.8rem;border:none;background:var(--utb-gris2);cursor:pointer;font-weight:700;font-size:0.95rem;transition:all .3s;color:#777;}
.auth-tab.active{background:var(--utb-azul);color:white;}

.fg{margin-bottom:1.2rem;}
.fg label{display:block;color:var(--utb-azul);font-weight:700;font-size:0.85rem;margin-bottom:0.4rem;}
.fg input,.fg select{
  width:100%;padding:0.85rem 1rem;border:2px solid var(--utb-gris2);
  border-radius:10px;font-size:0.95rem;transition:all .3s;background:white;
}
.fg input:focus,.fg select:focus{outline:none;border-color:var(--utb-azul);box-shadow:0 0 0 3px rgba(0,59,113,.1);}

.btn-auth{
  width:100%;background:linear-gradient(135deg,var(--utb-azul),var(--utb-azul2));
  color:white;border:none;padding:1rem;border-radius:10px;font-size:1rem;
  font-weight:700;cursor:pointer;transition:all .3s;margin-top:.5rem;
}
.btn-auth:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,59,113,.4);}
.btn-auth.verde{background:linear-gradient(135deg,var(--utb-verde),var(--utb-verde2));}
.btn-auth.verde:hover{box-shadow:0 8px 25px rgba(0,132,61,.4);}

.auth-msg{padding:.8rem;border-radius:8px;font-size:.88rem;font-weight:600;margin-top:1rem;text-align:center;display:none;}
.auth-msg.error{background:#ffebee;color:#b71c1c;}
.auth-msg.ok{background:#e8f5e9;color:#1b5e20;}

.usuarios-info{background:var(--utb-gris);border-radius:10px;padding:.9rem;margin-bottom:1.5rem;font-size:.82rem;color:#555;text-align:center;}
.usuarios-info strong{color:var(--utb-azul);}

/* ====== APP ====== */
#appScreen{display:none;}

.app-header{
  background:linear-gradient(135deg,var(--utb-azul) 0%,var(--utb-azul2) 100%);
  color:white;padding:.9rem 2rem;display:flex;justify-content:space-between;
  align-items:center;position:sticky;top:0;z-index:100;
  box-shadow:0 4px 15px rgba(0,59,113,.4);
}
.header-left{display:flex;align-items:center;gap:1rem;}
.header-logo{width:42px;height:42px;background:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.4rem;}
.header-title h1{font-size:1.2rem;font-weight:800;}
.header-title p{font-size:.75rem;opacity:.8;letter-spacing:.5px;}
.header-right{display:flex;align-items:center;gap:1rem;}
.user-chip{background:rgba(255,255,255,.15);padding:.45rem 1.1rem;border-radius:25px;font-size:.88rem;font-weight:600;border:1px solid rgba(255,255,255,.3);}
.btn-out{background:white;color:var(--utb-azul);border:none;padding:.45rem 1.1rem;border-radius:25px;font-weight:700;cursor:pointer;font-size:.88rem;transition:all .3s;}
.btn-out:hover{transform:scale(1.05);}

/* Barra verde decorativa */
.accent-bar{height:5px;background:linear-gradient(90deg,var(--utb-verde),var(--utb-verde2),var(--utb-azul2));}

/* Leyenda */
.leyenda{display:flex;justify-content:center;gap:1.2rem;flex-wrap:wrap;padding:.9rem 2rem;background:white;border-bottom:1px solid var(--utb-gris2);}
.ley-item{display:flex;align-items:center;gap:.4rem;font-size:.78rem;font-weight:600;color:#555;}
.ley-dot{width:13px;height:13px;border-radius:50%;border:2px solid;}

/* Contenido */
.app-body{max-width:1350px;margin:2rem auto;padding:0 1.5rem;}

/* Stats */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem;margin-bottom:2rem;}
.stat{background:white;padding:1.2rem 1rem;border-radius:14px;text-align:center;box-shadow:0 4px 15px rgba(0,0,0,.06);border-top:4px solid;}
.stat .sn{font-size:2.2rem;font-weight:800;line-height:1;}
.stat .sl{font-size:.75rem;color:#777;font-weight:600;margin-top:.3rem;}
.s-total{border-color:var(--utb-azul);} .s-total .sn{color:var(--utb-azul);}
.s-am   {border-color:var(--b-amarillo);} .s-am .sn{color:var(--b-amarillo);}
.s-az   {border-color:var(--b-azul);} .s-az .sn{color:var(--b-azul);}
.s-vd   {border-color:var(--b-verde);} .s-vd .sn{color:var(--b-verde);}
.s-na   {border-color:var(--b-naranja);} .s-na .sn{color:var(--b-naranja);}
.s-ro   {border-color:var(--b-rojo);} .s-ro .sn{color:var(--b-rojo);}

/* Acciones */
.act-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem;}
.act-bar h2{font-size:1.6rem;color:var(--utb-azul);font-weight:800;}

.btn-nueva{
  background:linear-gradient(135deg,var(--utb-verde),var(--utb-verde2));
  color:white;border:none;padding:.8rem 1.8rem;border-radius:25px;
  font-size:.95rem;font-weight:700;cursor:pointer;transition:all .3s;
  display:flex;align-items:center;gap:.5rem;
}
.btn-nueva:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,132,61,.4);}

/* Filtros */
.filtros{display:flex;gap:.7rem;margin-bottom:1.5rem;flex-wrap:wrap;}
.fb{padding:.55rem 1.2rem;border:2px solid var(--utb-gris2);border-radius:25px;cursor:pointer;background:white;font-weight:600;font-size:.82rem;transition:all .3s;color:#666;}
.fb:hover,.fb.active{border-color:var(--utb-azul);color:var(--utb-azul);background:rgba(0,59,113,.07);}

/* Tabla */
.tabla-wrap{background:white;border-radius:18px;box-shadow:0 8px 30px rgba(0,0,0,.08);overflow:hidden;}
.t-head{
  display:grid;grid-template-columns:3fr 1.5fr 1.3fr 1.3fr 1.2fr 1.3fr;
  padding:1rem 1.5rem;gap:1rem;
  background:linear-gradient(135deg,var(--utb-azul),var(--utb-azul2));
  color:white;font-weight:700;font-size:.85rem;
}
.a-row{
  display:grid;grid-template-columns:3fr 1.5fr 1.3fr 1.3fr 1.2fr 1.3fr;
  padding:1rem 1.5rem;align-items:center;gap:1rem;
  border-bottom:1px solid var(--utb-gris2);transition:all .3s;
  border-left:5px solid transparent;
}
.a-row:last-child{border-bottom:none;}

.est-nueva  {background:var(--c-amarillo);border-left-color:var(--b-amarillo);}
.est-proxima{background:var(--c-azul);    border-left-color:var(--b-azul);}
.est-vigente{background:var(--c-verde);   border-left-color:var(--b-verde);}
.est-leve   {background:var(--c-naranja); border-left-color:var(--b-naranja);}
.est-vencida{background:var(--c-rojo);    border-left-color:var(--b-rojo);}
.est-completada{background:#f3e5f5;       border-left-color:#7b1fa2;}

.a-nombre{font-weight:600;color:var(--utb-texto);font-size:.95rem;}
.a-nombre.done{text-decoration:line-through;opacity:.6;}
.a-desc{font-size:.78rem;color:#888;margin-top:2px;}
.a-meta{font-size:.73rem;color:#aaa;margin-top:2px;}

.badge{display:inline-block;padding:.28rem .75rem;border-radius:20px;font-size:.73rem;font-weight:700;border:2px solid;}
.b-nueva    {background:var(--c-amarillo);color:#f57f17;border-color:var(--b-amarillo);}
.b-proxima  {background:var(--c-azul);    color:#0d47a1;border-color:var(--b-azul);}
.b-vigente  {background:var(--c-verde);   color:#1b5e20;border-color:var(--b-verde);}
.b-leve     {background:var(--c-naranja); color:#bf360c;border-color:var(--b-naranja);}
.b-vencida  {background:var(--c-rojo);    color:#7f0000;border-color:var(--b-rojo);}
.b-completada{background:#f3e5f5;         color:#4a148c;border-color:#7b1fa2;}

.btn-a{background:none;border:2px solid;padding:.38rem .75rem;border-radius:18px;cursor:pointer;font-size:.78rem;font-weight:700;transition:all .3s;}
.btn-comp{border-color:#2e7d32;color:#2e7d32;} .btn-comp:hover{background:#2e7d32;color:white;}
.btn-edit{border-color:var(--utb-azul2);color:var(--utb-azul2);} .btn-edit:hover{background:var(--utb-azul2);color:white;}
.btn-del {border-color:#b71c1c;color:#b71c1c;} .btn-del:hover{background:#b71c1c;color:white;}
.btn-lock{border-color:#bbb;color:#bbb;cursor:not-allowed;}
.acc{display:flex;gap:.35rem;flex-wrap:wrap;}

.empty{text-align:center;padding:4rem;color:#aaa;}
.empty .ei{font-size:4rem;margin-bottom:1rem;}

/* Modales */
.ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:1000;align-items:center;justify-content:center;}
.ov.open{display:flex;}
.mbox{background:white;padding:2.5rem;border-radius:18px;width:100%;max-width:540px;max-height:90vh;overflow-y:auto;position:relative;box-shadow:0 25px 60px rgba(0,0,0,.3);}
.mbox h3{color:var(--utb-azul);font-size:1.5rem;margin-bottom:1.8rem;padding-bottom:1rem;border-bottom:3px solid var(--utb-gris2);}
.mcls{position:absolute;top:1.1rem;right:1.1rem;background:var(--utb-gris2);border:none;border-radius:50%;width:33px;height:33px;font-size:1.1rem;cursor:pointer;color:var(--utb-azul);font-weight:700;display:flex;align-items:center;justify-content:center;}
.mcls:hover{background:var(--utb-azul);color:white;}
.mbox .fg input,.mbox .fg select,.mbox .fg textarea{width:100%;padding:.85rem 1rem;border:2px solid var(--utb-gris2);border-radius:10px;font-size:.92rem;transition:all .3s;}
.mbox .fg input:focus,.mbox .fg select:focus,.mbox .fg textarea:focus{outline:none;border-color:var(--utb-azul);box-shadow:0 0 0 3px rgba(0,59,113,.1);}
.btn-save{width:100%;background:linear-gradient(135deg,var(--utb-azul),var(--utb-azul2));color:white;border:none;padding:1rem;border-radius:10px;font-size:1rem;font-weight:700;cursor:pointer;transition:all .3s;margin-top:.5rem;}
.btn-save:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,59,113,.4);}

.cov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:2000;align-items:center;justify-content:center;}
.cov.open{display:flex;}
.cbox{background:white;padding:2.5rem;border-radius:18px;max-width:400px;width:90%;text-align:center;box-shadow:0 25px 60px rgba(0,0,0,.3);}
.cbox .ci{font-size:3.5rem;margin-bottom:1rem;}
.cbox h3{color:var(--utb-texto);margin-bottom:.8rem;font-size:1.3rem;}
.cbox p{color:#666;margin-bottom:2rem;line-height:1.6;font-size:.9rem;}
.cbtns{display:flex;gap:1rem;justify-content:center;}
.btn-cy{background:var(--utb-verde);color:white;border:none;padding:.8rem 1.8rem;border-radius:10px;font-weight:700;cursor:pointer;transition:all .3s;}
.btn-cy:hover{transform:scale(1.05);}
.btn-cn{background:#eee;color:#555;border:none;padding:.8rem 1.8rem;border-radius:10px;font-weight:700;cursor:pointer;}
.btn-cn:hover{background:#ddd;}

@media(max-width:900px){
  .t-head,.a-row{grid-template-columns:2.5fr 1.3fr 1.2fr 1fr;}
  .t-head span:nth-child(3),.a-row>*:nth-child(3),
  .t-head span:nth-child(4),.a-row>*:nth-child(4){display:none;}
}
@media(max-width:600px){
  .t-head{display:none;}
  .a-row{grid-template-columns:1fr;gap:.5rem;}
  .app-header{padding:.8rem 1rem;}
  .header-title p{display:none;}
}
</style>
</head>
<body>

<!-- ========== PANTALLA LOGIN/REGISTRO ========== -->
<div id="loginScreen">
  <div class="auth-box">
    <div class="auth-logo">
      <span class="escudo">ğŸ“</span>
      <h1>Universidad TecnolÃ³gica de BolÃ­var</h1>
      <p>Cronograma de Actividades</p>
    </div>

    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Iniciar SesiÃ³n</button>
      <button class="auth-tab" onclick="switchTab('registro')">Registrarse</button>
    </div>

    <!-- LOGIN -->
    <div id="tabLogin">
      <div class="fg">
        <label>ğŸ‘¤ Usuario</label>
        <input type="text" id="liUser" placeholder="Tu nombre de usuario" onkeydown="if(event.key==='Enter')login()">
      </div>
      <div class="fg">
        <label>ğŸ”’ ContraseÃ±a</label>
        <input type="password" id="liPass" placeholder="Tu contraseÃ±a" onkeydown="if(event.key==='Enter')login()">
      </div>
      <button class="btn-auth" onclick="login()">ğŸ” Ingresar</button>
      <div class="auth-msg" id="loginMsg"></div>
    </div>

    <!-- REGISTRO -->
    <div id="tabRegistro" style="display:none;">
      <div class="usuarios-info">
        MÃ¡ximo <strong>5 usuarios</strong> permitidos en el sistema.<br>
        Usuarios registrados: <strong id="contUsuarios">0</strong> / 5
      </div>
      <div class="fg">
        <label>ğŸ‘¤ Nombre completo</label>
        <input type="text" id="regNombre" placeholder="Ej: Juan PÃ©rez">
      </div>
      <div class="fg">
        <label>ğŸ·ï¸ Usuario</label>
        <input type="text" id="regUser" placeholder="Sin espacios (Ej: jperez)">
      </div>
      <div class="fg">
        <label>ğŸ”’ ContraseÃ±a</label>
        <input type="password" id="regPass" placeholder="MÃ­nimo 4 caracteres">
      </div>
      <div class="fg">
        <label>ğŸ”‘ Confirmar contraseÃ±a</label>
        <input type="password" id="regPass2" placeholder="Repite la contraseÃ±a">
      </div>
      <button class="btn-auth verde" onclick="registrar()">âœ… Crear Cuenta</button>
      <div class="auth-msg" id="regMsg"></div>
    </div>
  </div>
</div>

<!-- ========== APP ========== -->
<div id="appScreen">
  <div class="app-header">
    <div class="header-left">
      <div class="header-logo">ğŸ“</div>
      <div class="header-title">
        <h1>Cronograma UTB</h1>
        <p>UNIVERSIDAD TECNOLÃ“GICA DE BOLÃVAR</p>
      </div>
    </div>
    <div class="header-right">
      <div class="user-chip">ğŸ‘¤ <span id="currentUser">-</span></div>
      <button class="btn-out" onclick="logout()">Salir</button>
    </div>
  </div>
  <div class="accent-bar"></div>

  <!-- Leyenda -->
  <div class="leyenda">
    <div class="ley-item"><div class="ley-dot" style="background:var(--c-amarillo);border-color:var(--b-amarillo);"></div>Sin fecha o muy lejano</div>
    <div class="ley-item"><div class="ley-dot" style="background:var(--c-azul);border-color:var(--b-azul);"></div>ğŸ”µ MÃ¡s de 1 semana</div>
    <div class="ley-item"><div class="ley-dot" style="background:var(--c-verde);border-color:var(--b-verde);"></div>ğŸŸ¢ Menos de 1 semana hasta el dÃ­a</div>
    <div class="ley-item"><div class="ley-dot" style="background:var(--c-naranja);border-color:var(--b-naranja);"></div>ğŸŸ  Hasta 1 semana de retraso</div>
    <div class="ley-item"><div class="ley-dot" style="background:var(--c-rojo);border-color:var(--b-rojo);"></div>ğŸ”´ MÃ¡s de 1 semana de retraso</div>
  </div>

  <div class="app-body">
    <!-- Stats -->
    <div class="stats" id="statsGrid"></div>

    <!-- Barra acciones -->
    <div class="act-bar">
      <h2>ğŸ“‹ Actividades del Proyecto</h2>
      <button class="btn-nueva" onclick="abrirModal()">ï¼‹ Nueva Actividad</button>
    </div>

    <!-- Filtros -->
    <div class="filtros">
      <button class="fb active" onclick="filtrar('todas',this)">Todas</button>
      <button class="fb" onclick="filtrar('nueva',this)">ğŸŸ¡ Sin fecha</button>
      <button class="fb" onclick="filtrar('proxima',this)">ğŸ”µ Lejanas</button>
      <button class="fb" onclick="filtrar('vigente',this)">ğŸŸ¢ PrÃ³ximas</button>
      <button class="fb" onclick="filtrar('leve',this)">ğŸŸ  Retraso leve</button>
      <button class="fb" onclick="filtrar('vencida',this)">ğŸ”´ Vencidas</button>
      <button class="fb" onclick="filtrar('completada',this)">âœ… Completadas</button>
    </div>

    <!-- Tabla -->
    <div class="tabla-wrap">
      <div class="t-head">
        <span>Actividad</span>
        <span>Responsable</span>
        <span>Inicio</span>
        <span>Fecha lÃ­mite</span>
        <span>Estado</span>
        <span>Acciones</span>
      </div>
      <div id="actList"></div>
    </div>
  </div>
</div>

<!-- Modal Nueva/Editar -->
<div class="ov" id="modalAct">
  <div class="mbox">
    <button class="mcls" onclick="cerrarModal()">âœ•</button>
    <h3 id="mTitle">Nueva Actividad</h3>
    <div class="fg"><label>ğŸ“Œ Nombre *</label><input type="text" id="aNombre" placeholder="Nombre de la actividad"></div>
    <div class="fg"><label>ğŸ“ DescripciÃ³n</label><textarea id="aDesc" rows="3" placeholder="DescripciÃ³n breve..."></textarea></div>
    <div class="fg"><label>ğŸ‘¤ Responsable *</label><input type="text" id="aResp" placeholder="Nombre del responsable"></div>
    <div class="fg"><label>ğŸ“… Fecha de Inicio *</label><input type="date" id="aInicio"></div>
    <div class="fg"><label>â° Fecha LÃ­mite *</label><input type="date" id="aFecha"></div>
    <div class="fg">
      <label>ğŸ·ï¸ Prioridad</label>
      <select id="aPrioridad">
        <option value="alta">ğŸ”´ Alta</option>
        <option value="media" selected>ğŸŸ¡ Media</option>
        <option value="baja">ğŸŸ¢ Baja</option>
      </select>
    </div>
    <button class="btn-save" onclick="guardar()">ğŸ’¾ Guardar Actividad</button>
  </div>
</div>

<!-- Modal Confirmar Completar -->
<div class="cov" id="confirmOv">
  <div class="cbox">
    <div class="ci">âœ…</div>
    <h3>Â¿Marcar como completada?</h3>
    <p id="confirmTxt">Una vez confirmada, la actividad no podrÃ¡ ser editada.</p>
    <div class="cbtns">
      <button class="btn-cy" onclick="confirmarCompletar()">SÃ­, confirmar</button>
      <button class="btn-cn" onclick="cerrarConfirm()">Cancelar</button>
    </div>
  </div>
</div>

<script>
// ============ STORAGE ============
const KEY_USERS = 'utb_usuarios';
const KEY_ACTS  = 'utb_actividades';

const getUsers = () => JSON.parse(localStorage.getItem(KEY_USERS) || '[]');
const saveUsers = u => localStorage.setItem(KEY_USERS, JSON.stringify(u));
const getActs   = () => JSON.parse(localStorage.getItem(KEY_ACTS)  || '[]');
const saveActs  = a => localStorage.setItem(KEY_ACTS,  JSON.stringify(a));

let userActual = null, editId = null, pendiente = null, filtroAct = 'todas';

// ============ AUTH TABS ============
function switchTab(tab) {
  document.querySelectorAll('.auth-tab').forEach((t,i) => t.classList.toggle('active', (i===0&&tab==='login')||(i===1&&tab==='registro')));
  document.getElementById('tabLogin').style.display    = tab==='login'    ? '' : 'none';
  document.getElementById('tabRegistro').style.display = tab==='registro' ? '' : 'none';
  if(tab==='registro') actualizarContador();
}

function actualizarContador() {
  document.getElementById('contUsuarios').textContent = getUsers().length;
}

// ============ REGISTRO ============
function registrar() {
  const nombre = document.getElementById('regNombre').value.trim();
  const user   = document.getElementById('regUser').value.trim().toLowerCase().replace(/\s+/g,'');
  const pass   = document.getElementById('regPass').value;
  const pass2  = document.getElementById('regPass2').value;
  const msg    = document.getElementById('regMsg');

  const mostrar = (txt, tipo) => { msg.textContent = txt; msg.className = `auth-msg ${tipo}`; msg.style.display='block'; };

  if(!nombre || !user || !pass || !pass2) return mostrar('âš ï¸ Completa todos los campos','error');
  if(pass.length < 4) return mostrar('âš ï¸ La contraseÃ±a debe tener mÃ­nimo 4 caracteres','error');
  if(pass !== pass2) return mostrar('âš ï¸ Las contraseÃ±as no coinciden','error');

  const users = getUsers();
  if(users.length >= 5) return mostrar('âŒ Se alcanzÃ³ el lÃ­mite de 5 usuarios','error');
  if(users.find(u => u.user === user)) return mostrar('âŒ Ese nombre de usuario ya existe','error');

  users.push({ user, nombre, pass });
  saveUsers(users);
  mostrar('âœ… Cuenta creada. Ya puedes iniciar sesiÃ³n.','ok');
  setTimeout(() => switchTab('login'), 1500);

  document.getElementById('regNombre').value = '';
  document.getElementById('regUser').value   = '';
  document.getElementById('regPass').value   = '';
  document.getElementById('regPass2').value  = '';
}

// ============ LOGIN ============
function login() {
  const user = document.getElementById('liUser').value.trim().toLowerCase();
  const pass = document.getElementById('liPass').value;
  const msg  = document.getElementById('loginMsg');

  const found = getUsers().find(u => u.user === user && u.pass === pass);
  if(found) {
    userActual = found;
    document.getElementById('currentUser').textContent = found.nombre || found.user;
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('appScreen').style.display   = 'block';
    msg.style.display = 'none';
    cargar();
  } else {
    msg.textContent = 'âŒ Usuario o contraseÃ±a incorrectos';
    msg.className = 'auth-msg error';
    msg.style.display = 'block';
    document.getElementById('liPass').value = '';
  }
}

function logout() {
  userActual = null;
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('appScreen').style.display   = 'none';
  document.getElementById('liUser').value = '';
  document.getElementById('liPass').value = '';
  document.getElementById('loginMsg').style.display = 'none';
}

// ============ ESTADO POR FECHA ============
function getEstado(act) {
  if(act.completada) return 'completada';
  if(!act.fechaLimite) return 'nueva';

  const hoy = new Date(); hoy.setHours(0,0,0,0);
  const lim = new Date(act.fechaLimite + 'T00:00:00');
  const dias = Math.ceil((lim - hoy) / 86400000);

  if(dias > 7)   return 'proxima';   // ğŸ”µ MÃ¡s de 1 semana
  if(dias >= 0)  return 'vigente';   // ğŸŸ¢ Hasta el dÃ­a lÃ­mite
  if(dias >= -7) return 'leve';      // ğŸŸ  Hasta 1 semana vencida
  return 'vencida';                   // ğŸ”´ MÃ¡s de 1 semana vencida
}

const ELABELS = { nueva:'Sin fecha', proxima:'Lejana (+7d)', vigente:'PrÃ³xima âœ“', leve:'Retraso leve', vencida:'Vencida', completada:'Completada âœ…' };
const EBADGE  = { nueva:'b-nueva', proxima:'b-proxima', vigente:'b-vigente', leve:'b-leve', vencida:'b-vencida', completada:'b-completada' };
const EROW    = { nueva:'est-nueva', proxima:'est-proxima', vigente:'est-vigente', leve:'est-leve', vencida:'est-vencida', completada:'est-completada' };
const PRIO    = { alta:'ğŸ”´ Alta', media:'ğŸŸ¡ Media', baja:'ğŸŸ¢ Baja' };

function fFecha(f) { if(!f) return '-'; const[y,m,d]=f.split('-'); return `${d}/${m}/${y}`; }

// ============ MODAL ============
function abrirModal(id=null) {
  editId = id;
  if(id!==null) {
    const a = getActs().find(x=>x.id===id);
    document.getElementById('mTitle').textContent = 'âœï¸ Editar Actividad';
    document.getElementById('aNombre').value   = a.nombre;
    document.getElementById('aDesc').value     = a.descripcion||'';
    document.getElementById('aResp').value     = a.responsable;
    document.getElementById('aInicio').value   = a.fechaInicio||'';
    document.getElementById('aFecha').value    = a.fechaLimite||'';
    document.getElementById('aPrioridad').value= a.prioridad||'media';
  } else {
    document.getElementById('mTitle').textContent = 'â• Nueva Actividad';
    ['aNombre','aDesc','aResp','aInicio','aFecha'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('aPrioridad').value='media';
  }
  document.getElementById('modalAct').classList.add('open');
}
function cerrarModal(){ document.getElementById('modalAct').classList.remove('open'); editId=null; }

function guardar() {
  const n=document.getElementById('aNombre').value.trim();
  const r=document.getElementById('aResp').value.trim();
  const i=document.getElementById('aInicio').value;
  const f=document.getElementById('aFecha').value;
  if(!n||!r||!i||!f){ alert('âš ï¸ Completa todos los campos obligatorios'); return; }

  const acts=getActs();
  if(editId!==null){
    const idx=acts.findIndex(a=>a.id===editId);
    if(idx>=0){ acts[idx]={...acts[idx],nombre:n,descripcion:document.getElementById('aDesc').value,responsable:r,fechaInicio:i,fechaLimite:f,prioridad:document.getElementById('aPrioridad').value}; }
  } else {
    acts.push({id:Date.now(),nombre:n,descripcion:document.getElementById('aDesc').value,responsable:r,fechaInicio:i,fechaLimite:f,prioridad:document.getElementById('aPrioridad').value,completada:false,creadaPor:userActual.user,creadaEn:new Date().toISOString()});
  }
  saveActs(acts); cerrarModal(); cargar();
}

// ============ COMPLETAR ============
function solicitarCompletar(id){
  pendiente=id;
  const a=getActs().find(x=>x.id===id);
  document.getElementById('confirmTxt').textContent=`Â¿Marcar "${a.nombre}" como completada? Esta acciÃ³n no se puede deshacer ni editar.`;
  document.getElementById('confirmOv').classList.add('open');
}
function confirmarCompletar(){
  if(pendiente===null) return;
  const acts=getActs();
  const idx=acts.findIndex(a=>a.id===pendiente);
  if(idx>=0){ acts[idx].completada=true; acts[idx].completadaEn=new Date().toISOString(); acts[idx].completadaPor=userActual.user; }
  saveActs(acts); cerrarConfirm(); cargar();
}
function cerrarConfirm(){ document.getElementById('confirmOv').classList.remove('open'); pendiente=null; }

// ============ ELIMINAR ============
function eliminar(id){
  if(!confirm('Â¿Eliminar esta actividad? No se puede deshacer.')) return;
  saveActs(getActs().filter(a=>a.id!==id)); cargar();
}

// ============ FILTRAR ============
function filtrar(e,btn){
  filtroAct=e;
  document.querySelectorAll('.fb').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  cargar();
}

// ============ RENDER ============
function cargar(){
  const acts=getActs();
  const cnt={total:acts.length,nueva:0,proxima:0,vigente:0,leve:0,vencida:0};
  acts.forEach(a=>{ const e=getEstado(a); if(e!=='completada') cnt[e]=(cnt[e]||0)+1; });

  document.getElementById('statsGrid').innerHTML=`
    <div class="stat s-total"><div class="sn">${cnt.total}</div><div class="sl">Total</div></div>
    <div class="stat s-am"><div class="sn">${cnt.nueva||0}</div><div class="sl">ğŸŸ¡ Sin fecha</div></div>
    <div class="stat s-az"><div class="sn">${cnt.proxima||0}</div><div class="sl">ğŸ”µ Lejanas</div></div>
    <div class="stat s-vd"><div class="sn">${cnt.vigente||0}</div><div class="sl">ğŸŸ¢ PrÃ³ximas</div></div>
    <div class="stat s-na"><div class="sn">${cnt.leve||0}</div><div class="sl">ğŸŸ  Retraso leve</div></div>
    <div class="stat s-ro"><div class="sn">${cnt.vencida||0}</div><div class="sl">ğŸ”´ Vencidas</div></div>
  `;

  const filtradas=filtroAct==='todas' ? acts : acts.filter(a=>getEstado(a)===filtroAct);
  const cont=document.getElementById('actList');

  if(!filtradas.length){
    cont.innerHTML='<div class="empty"><div class="ei">ğŸ“­</div><p>No hay actividades en esta categorÃ­a</p></div>';
    return;
  }

  cont.innerHTML=filtradas.map(a=>{
    const e=getEstado(a);
    const done=a.completada;
    const bComp=done
      ? `<button class="btn-a btn-lock" disabled>âœ…</button>`
      : `<button class="btn-a btn-comp" onclick="solicitarCompletar(${a.id})" title="Completar">âœ”</button>`;
    const bEdit=done
      ? `<button class="btn-a btn-lock" disabled title="Bloqueado">ğŸ”’</button>`
      : `<button class="btn-a btn-edit" onclick="abrirModal(${a.id})" title="Editar">âœï¸</button>`;
    return `
      <div class="a-row ${EROW[e]}">
        <div>
          <div class="a-nombre ${done?'done':''}">${a.nombre}</div>
          ${a.descripcion?`<div class="a-desc">${a.descripcion}</div>`:''}
          <div class="a-meta">${PRIO[a.prioridad]||''} Â· ${a.creadaPor||'-'}</div>
        </div>
        <div style="font-weight:600;color:#444;">${a.responsable}</div>
        <div style="font-size:.88rem;color:#666;">${fFecha(a.fechaInicio)}</div>
        <div style="font-size:.88rem;font-weight:600;">${fFecha(a.fechaLimite)}</div>
        <div><span class="badge ${EBADGE[e]}">${ELABELS[e]}</span></div>
        <div class="acc">
          ${bComp}${bEdit}
          <button class="btn-a btn-del" onclick="eliminar(${a.id})" title="Eliminar">ğŸ—‘</button>
        </div>
      </div>`;
  }).join('');
}

// Cerrar modales al click fuera
document.getElementById('modalAct').addEventListener('click',e=>{ if(e.target===document.getElementById('modalAct')) cerrarModal(); });
document.getElementById('confirmOv').addEventListener('click',e=>{ if(e.target===document.getElementById('confirmOv')) cerrarConfirm(); });
</script>
</body>
</html>